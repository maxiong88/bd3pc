var loginJS = {
    emailReg : /^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/,
    errorTip : function(e, el, txt, n){
        console.log(n)
        if(n === 1){
            e.parent().find(el).html(txt).show();
        }else if(n===2){
            e.parent().find(el).html(txt).hide();
        }
        
    },
    successTip : function(){

    },
    ajaxTo:function(url, data, cb, err){
        $.ajax({
            type: 'get',
            url : url,
            data:data,
            dataType: 'json',
            success: function(res){
                res.status === 1 ? cb && cb(res) : err && err(res);
            }
        })
    },
    init:function(){
        var that = this;
        $('#_js_ChangePWD').on('click', function(){
            var username = $(this).parent().find('#username_c').val();
            var smscode = $(this).parent().find('.smscode_c').val();
            if(username === ''){
                that.errorTip($(this), '.from-email .err-tip', '邮箱地址不能为空', 1);
                return;
            }else{
                that.errorTip($(this), '.from-email .err-tip', '', 2)
            }
            if(!loginJS.emailReg.test(username)){
                that.errorTip($(this), '.from-email .err-tip', '邮箱格式不正确', 1)
                return;
            }else{
                that.errorTip($(this), '.from-email .err-tip', '', 2)
            }
            if(smscode === ''){
                that.errorTip($(this), '.from-smscode .err-tip', '验证码不能为空', 1)
                return;
            }
            // ajax
            // $(this).parent().find('.from-smscode .err-tip').html('验证码不正确').show();
            $('.con-body').hide();
            $('.forget-body-1 .username').html(username);
            $('.forget-body-1').show();
            // that.ajaxTo('更改密码url', {
            //     username:username,
            //     smscode:smscode,
            // }, function(res){
            //     alert(res.message)
            // },function(res){
            //     alert(res.message)
            // })
        });
        $('#_js_ChangePWD1').on('click', function(){
            $username_b = $('#username_b').val();
            $password1_b = $('#password1_b').val();
            $password2_b = $('#password2_b').val();
            if($password1_b === ''){
                that.errorTip($(this), '.password1 + .err-tip', '密码不能为空', 1);
                return;
            }else{
                that.errorTip($(this), '.password1 + .err-tip', '', 2);
            }
            if($password2_b === ''){
                that.errorTip($(this), '.password2 + .err-tip', '确认密码不能为空', 1);
                return;
            }else{
                that.errorTip($(this), '.password2 + .err-tip', '', 2);
            }
            if($password2_b !== $password1_b){
                that.errorTip($(this), '.password2 + .err-tip', '密码不一致', 1);
                return;
            }
            // 密码修改成功
            alert('密码修改成功')
        })
        $('#_js_RegStep1').on('click', function(){
            $('.con-body').hide();
            $('.register-body-2').show();
        });
        // 点击图片上传
        $('#_js_file_upload').change(function(e){
            var file = e.target.files && e.target.files[0];
            
            if (!(/^image\/.*$/i.test(file.type))) {
                alert('请上传正确格式图片');
                return; //不是图片 就跳出这一次循环  
            }
            if (file.size > 500000) {
                alert('请上传小于500kb图片');
                return; //  大小 
            }
            $('.register-body-2 .item-3').html('')
            //实例化FileReader API  
            var freader = new FileReader();  
            freader.readAsDataURL(file);  
            freader.onload = function(e) {
                var img = new Image();
                img.src = e.target.result;
                $('.register-body-2 .item-3').html(img)
            } 
        })
        $('#_js_RegStep2').on('click', function(){
            
        });
        // 记住密码 == 这里要注入cookie
        $('#bd-checkbox-forget').on('change', function(){
            if($(this).hasClass('is-checked')){
                // 移除
                $(this).removeClass('is-checked');
                $(this).find('.bd-checkbox__input').removeClass('is-checked');
            }else{
                // 注入
                $(this).addClass('is-checked');
                $(this).find('.bd-checkbox__input').addClass('is-checked');
            }

        });
        // 忘记密码
        $('#forgetPass').on('click', function(){
            $('.con-body').hide();
            $('.forget-body').show();
        });
        // 登录
        $('#_js_login').on('click', function(){
            var username = $(this).parent().find('.username').val();
            var password = $(this).parent().find('.password').val();
            // ajax发送用户名，密码进行登录
            // $.ajax({ })
            // 模拟  ==输入登录成功
            if(username === ''){
                $(this).parent().find('.username + .err-tip').html('邮箱不能为空').css("left","93px").show()
                return ;
            }else{
                $(this).parent().find('.username + .err-tip').html('').css("left","93px").hide()
            }
            if (!loginJS.emailReg.test(username)){
                $(this).parent().find('.username + .err-tip').html('请输入正确邮箱').css("left","93px").show()
                return;
            }else{
                $(this).parent().find('.username + .err-tip').html('').css("left","93px").hide()
            }
            if(password === ''){
                $(this).parent().find('.password + .err-tip').html('密码不能为空').css("left","93px").show()
                return ;
            }else{
                $(this).parent().find('.password + .err-tip').html('').css("left","93px").hide()
            }
                window.location.href="进入上一次登录页面"
            
            
        });
        // 返回登录页 // 已有账号，去登陆
        $('._js_go_login').on('click', function(){
            $('.con-body').hide();
            $('.login-body').show();  
        })
        // 注册账号
        $('#_js_loginin').on('click', function(){
            $('.con-body').hide();
            $('.register-body-1').show();
        });
        // 完成注册
        $('#_js_RegStep2').on('click', function(){
            // 注册成功以后倒计时
            setTimeout("lazyGo();", 1000);
            function lazyGo() {
                var sec = $("#sec").text();
                $("#sec").text(--sec);
                if (sec > 0){
                    setTimeout("lazyGo();", 1000);
                }else{
                   window.location.href="完成注册";
                }
            }
        });
        $('.tip-box-s-d').on('click', function(){
            window.location.href="完成注册";
        })
    }
}
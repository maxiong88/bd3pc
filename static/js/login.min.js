var loginJS = {
    errorTip : function(e, el, txt, n){
        console.log(n)
        if(n === 1){
            e.parent().find(el).html(txt).show();
        }else if(n===2){
            e.parent().find(el).html(txt).hide();
        }
        
    },
    _input_check_tips: function(e, t, n, r) {
        var i = t.parents(".from-item").find(".err-tip");
        return n && !e ? (t.addClass("error"),
        r && t.focus(),
        void i.show().addClass("error").html(n)) : (t.removeClass("error"),
        void i.hide())
    },
    _is_mail: function(e) {
        var t = /^([a-zA-Z0-9]+[_|\_|\.|-]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.|-]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/g;
        return t.test(e)
    },
    _check_mail: function(e, t) {
        var n = this
          , r = e.val();
        return r ? n._is_mail(r) ? (n._input_check_tips(null, e),
        !0) : (n._input_check_tips(null, e, "请输入正确的邮箱地址", t),
        !1) : (n._input_check_tips(null, e, "请输入邮箱地址", t),
        !1)
    },
    _check_name: function(e, t) {
        var n, r, i = this, o = e.val();
        return o ? (n = /^[A-Za-z0-9\u4e00-\u9fa5_-]+$/.test(o)) ? o && o.length < 2 ? (i._input_check_tips(null, e, "昵称不能少于2个字符", t),
        !1) : (r = /^[\u4e00-\u9fa5]+$/.test(o),
        !(o && o.length > (r ? 10 : 10)) || (i._input_check_tips(null, e, r ? "纯中文昵称最长10个字符" : "昵称最长10个字符", t),
        !1)) : (i._input_check_tips(null, e, "昵称只能由中文、字母、数字、下划线或者短横线组成", t),
        !1) : (i._input_check_tips(null, e, "请输入昵称", t),
        !1)
    },
    _check_password: function(e, t) {
        var n = this
          , r = e.val()
          , i = !(r.match(/[0-9]/) || r.match(/[a-zA-Z]/) || /\W/.test(r));
        return r ? 
        r.length < 6 ? 
        (n._input_check_tips(null, e, "密码不能少于6位", t),!1) : 
        r.length > 18 ? 
        (n._input_check_tips(null, e, "密码不能多于18位", t),!1) : 
        !i || (n._input_check_tips(null, e, "密码必须是字母或特殊符号或数字", t),!1) : 
        (n._input_check_tips(null, e, "请输入密码", t),!1)
    },
    _check_password2: function(e, t, n) {
        var r = this
          , i = (e.val(),
        t.val());
        return i ? e.val() === t.val() || (r._input_check_tips(null, t, "两次密码不一样", n),
        !1) : (r._input_check_tips(null, t, "请输入确认密码", n),
        !1)
    },
    ajaxTo:function(url, data, cb, err){
        $.ajax({
            type: 'get',
            url : url,
            data:data,
            dataType: 'json',
            success: function(res){
                res.status === 1 ? cb && cb(res) : err && err(res);
            }
        })
    },
    init:function(){
        var that = this;
        $('#_js_ChangePWD').on('click', function(){
            var username = $('#username_c').val();
            var smscode = $('.smscode_c').val();
            
            if( !!that._check_mail($('#username_c'), !0) ){
                if(smscode === ''){
                    return !!that._input_check_tips(null, $('.smscode_c'), "请输入邮箱验证码", !0);
                }
                // 判断验证码是否正确
                // !!that._input_check_tips(null, $('.smscode_c'), "邮箱验证码不正确", !0)
                    $('.con-body').hide();
                    $('.forget-body-1 .username').html(username);
                    $('.forget-body-1').show();
                // that.ajaxTo('更改密码url', {
                //     username:username,
                //     smscode:smscode,
                // }, function(res){
                //     alert(res.message)
                // },function(res){
                //     alert(res.message)
                // })
             }
        });
        $('#_js_ChangePWD1').on('click', function(){
            $username_b = $('#username_b').val();
            $password1_b = $('#password1_b').val();
            $password2_b = $('#password2_b').val();

            if( !!that._check_password($('#password1_b'), !0) && !!that._check_password2($('#password1_b'), $('#password2_b'), !0) ){
                // $('.login-success').find('.tip-box-s-a span').html('提示');
                // $('.login-success').find('.tip-bx-s-b p').html('密码修改成功');
                // $('.login-success').show();
                alert('密码修改成功')
            }
        });
        $('#password1_b').on("blur", function() {
            var e = $(this);
            loginJS._input_check_tips(e.val(), e)
            loginJS._check_password($('#password1_b'), !0)
        });
        $('#password2_b').on("blur", function() {
            var e = $(this);
            loginJS._input_check_tips(e.val(), e)
            loginJS._check_password2($('#password1_b'), $('#password2_b'), !0)
        });
        $('#username_d').on("blur", function() {
            var e = $(this);
            loginJS._input_check_tips(e.val(), e)
            loginJS._check_mail($('#username_d'), !0)
        });
        $('#password1_d').on("blur", function() {
            var e = $(this);
            loginJS._input_check_tips(e.val(), e)
            loginJS._check_password($('#password1_d'), !0)
        });
        $('#password2_d').on("blur", function() {
            var e = $(this);
            loginJS._input_check_tips(e.val(), e)
            loginJS._check_password2($('#password1_d'), $('#password2_d'), !0)
        });
        $('#_js_RegStep1').on('click', function(){
            var $username_d = $('#username_d').val();
            var $password1_d = $('#password1_d').val();
            var $password2_d = $('#password2_d').val();
            if(!!that._check_mail($('#username_d'), !0) && !!that._check_password($('#password1_d'), !0) && !!that._check_password2($('#password1_d'), $('#password2_d'), !0)){
                // 如果邮箱被占用 
                that._input_check_tips(null, $('#username_d'), "该邮箱已被注册");
                $('.con-body').hide();
                $('.register-body-2').show();
            }
        });
        // 点击图片上传
        $('#_js_file_upload').change(function(e){
            var file = e.target.files && e.target.files[0];
            
            if (!(/^image\/.*$/i.test(file.type))) {
                alert('请上传正确格式图片');
                return; //不是图片 就跳出这一次循环  
            }
            if (file.size > 500000) {
                alert('请上传小于500kb图片');
                return; //  大小 
            }
            $('.register-body-2 .item-3').html('')
            //实例化FileReader API  
            var freader = new FileReader();  
            freader.readAsDataURL(file);  
            freader.onload = function(e) {
                var img = new Image();
                img.src = e.target.result;
                $('.register-body-2 .item-3').html(img)
            } 
        })
        // 记住密码 == 这里要注入cookie
        $('#bd-checkbox-forget').on('change', function(){
            if($(this).hasClass('is-checked')){
                // 移除
                $(this).removeClass('is-checked');
                $(this).find('.bd-checkbox__input').removeClass('is-checked');
            }else{
                // 注入
                $(this).addClass('is-checked');
                $(this).find('.bd-checkbox__input').addClass('is-checked');
            }
        });
        // 忘记密码
        $('#forgetPass').on('click', function(){
            $('.con-body').hide();
            $('.forget-body').show();
        });
        // 登录
        $('#_js_login').on('click', function(){
            var username = $('#username_a').val();
            var password = $('#password_a').val();     
            var cookiePass =  $('#bd-checkbox-forget').hasClass('is-checked') ? 1 : 0;
            if(!!that._check_mail($('#username_a'), !0) && !!that._check_password($('#password_a'), !0)){
                // cookiePass
                window.location.href="/"
            }  
        });
        // 返回登录页 // 已有账号，去登陆
        $('._js_go_login').on('click', function(){
            $('.con-body').hide();
            $('.login-body').show();  
        })
        // 注册账号
        $('#_js_loginin').on('click', function(){
            $('.con-body').hide();
            $('.register-body-1').show();
        });
        // 完成注册
        $('#username_f').on("blur", function() {
            var e = $(this);
            loginJS._input_check_tips(e.val(), e)
            loginJS._check_name(e)
        });
        $('#_js_RegStep2').on('click', function(){
            if(!!that._check_name($('#username_f'))){
                $('.login-success').show();
                //设定倒数秒数  
                setTimeout(function(){
                    lazyGo()
                }, 1000)
            }
        });
        $('.tip-box-s-d').on('click', function(){
            window.location.href="完成注册";
        })
    }
}
var sec = $("#sec").text();
function lazyGo() {
    $("#sec").text(--sec);
    if (sec === 0){
        window.location.href="/";
    }
    setTimeout('lazyGo()', 1000);
}